<div class="h-full flex bg-gray-900/80 backdrop-blur-sm text-gray-200">
  <div class="w-48 bg-gray-900/50 p-2 flex-shrink-0">
    <h2 class="text-lg font-bold p-2 mb-2">Settings</h2>
    <ul>
      <li>
        <button (click)="activeTab.set('personalization')" 
                [class.bg-gray-700]="activeTab() === 'personalization'"
                class="w-full text-left p-2 rounded hover:bg-gray-700 transition-colors">
          <i class="fas fa-palette mr-2 w-4"></i>Personalization
        </button>
      </li>
      <li>
        <button (click)="activeTab.set('api-keys')" 
                [class.bg-gray-700]="activeTab() === 'api-keys'"
                class="w-full text-left p-2 rounded hover:bg-gray-700 transition-colors">
          <i class="fas fa-key mr-2 w-4"></i>API Keys
        </button>
      </li>
      <li>
        <button (click)="activeTab.set('system')" 
                [class.bg-gray-700]="activeTab() === 'system'"
                class="w-full text-left p-2 rounded hover:bg-gray-700 transition-colors">
          <i class="fas fa-desktop mr-2 w-4"></i>System
        </button>
      </li>
      <li>
        <button (click)="activeTab.set('data')" 
                [class.bg-gray-700]="activeTab() === 'data'"
                class="w-full text-left p-2 rounded hover:bg-gray-700 transition-colors">
          <i class="fas fa-database mr-2 w-4"></i>Data Management
        </button>
      </li>
    </ul>
  </div>

  <div class="flex-1 p-6 overflow-y-auto">
    @switch (activeTab()) {
      @case ('personalization') {
        <h3 class="text-2xl font-bold mb-6">Personalization</h3>
        
        <div class="mb-8">
          <h4 class="text-lg font-semibold mb-3">Accent Color</h4>
          <div class="flex flex-wrap gap-3">
            @for (color of accentColors; track color) {
              <button (click)="settingsService.setAccentColor(color)"
                      [class.ring-2]="settingsService.accentColor() === color"
                      [style.background-color]="'var(--accent-color-' + color + ')'"
                      class="w-10 h-10 rounded-full ring-offset-2 ring-offset-gray-800 transition-all">
              </button>
            }
          </div>
        </div>

        <div class="mb-8">
          <h4 class="text-lg font-semibold mb-3">Wallpaper</h4>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            @for (wallpaper of wallpapers; track wallpaper.id) {
              <div (click)="settingsService.setWallpaper(wallpaper.id)"
                   [class.ring-2]="settingsService.wallpaper() === wallpaper.id"
                   class="aspect-video rounded-md cursor-pointer ring-offset-2 ring-offset-gray-800 accent-ring-focus overflow-hidden"
                   [ngClass]="wallpaper.id">
                   <div class="h-full w-full flex items-end p-2 bg-black/20">
                     <span class="text-white font-semibold text-sm">{{ wallpaper.name }}</span>
                   </div>
              </div>
            }
          </div>
        </div>
        
        <div class="pt-6 border-t border-gray-700">
          <h4 class="text-lg font-semibold mb-3">Custom Wallpaper</h4>
          <div class="bg-gray-800/50 p-4 rounded-lg flex items-start gap-4">
            @if (customWallpaperPreview()) {
              <img [src]="customWallpaperPreview()" alt="Wallpaper Preview" class="w-32 h-20 object-cover rounded">
            } @else {
              <div class="w-32 h-20 bg-gray-700 rounded flex items-center justify-center">
                <i class="fas fa-image text-3xl text-gray-500"></i>
              </div>
            }
            <div class="flex-1">
              <p class="text-sm text-gray-400 mb-2">Upload an image to use as your desktop background.</p>
              <input type="file" #fileInput class="hidden" accept="image/*" (change)="onWallpaperFileSelected($event)">
              <div class="flex gap-2">
                  <button (click)="fileInput.click()" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold px-4 py-2 rounded-md transition-opacity text-sm">
                    <i class="fas fa-upload mr-2"></i>Choose Image
                  </button>
                  @if (customWallpaperPreview()) {
                    <button (click)="setCustomWallpaper()" class="accent-bg text-white font-semibold px-4 py-2 rounded-md hover:opacity-90 transition-opacity text-sm">
                      Apply
                    </button>
                  }
              </div>
            </div>
          </div>
        </div>
      }
      @case ('api-keys') {
        <h3 class="text-2xl font-bold mb-6">API Keys</h3>
        <div class="p-4 bg-gray-800/50 rounded-lg mb-6">
          <h4 class="text-lg font-semibold mb-3">Google Gemini API</h4>
          <p class="text-sm text-gray-400 mb-4">Provide your Google Gemini API key to enable AI features like Banana Copilot. You can get a free key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-400 hover:underline">Google AI Studio</a>.</p>
          
          <div class="flex gap-2 mb-2">
            <div class="relative flex-grow">
              <input [type]="isGeminiKeyVisible() ? 'text' : 'password'"
                     placeholder="Enter your Gemini API key..."
                     [value]="geminiApiKey()"
                     (input)="geminiApiKey.set($any($event.target).value)"
                     class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 accent-ring-focus pr-10">
              <button (click)="isGeminiKeyVisible.set(!isGeminiKeyVisible())" class="absolute inset-y-0 right-0 px-3 text-gray-400 hover:text-white">
                <i class="fas" [class.fa-eye]="!isGeminiKeyVisible()" [class.fa-eye-slash]="isGeminiKeyVisible()"></i>
              </button>
            </div>
            <button (click)="saveGeminiApiKey()" class="accent-bg text-white font-semibold px-4 py-2 rounded-md hover:opacity-90 transition-opacity">
                <i class="fas fa-save mr-2"></i>Save
            </button>
          </div>
          <div class="text-xs text-gray-500">
            <span>Status: </span>
            @if (apiKeyService.apiKey()) {
              <span class="text-green-400">Key is set ({{ maskedGeminiApiKey() }})</span>
            } @else {
              <span class="text-yellow-400">Not configured</span>
            }
          </div>
        </div>
        <div class="p-4 bg-gray-800/50 rounded-lg">
          <h4 class="text-lg font-semibold mb-3">OpenWeatherMap API</h4>
          <p class="text-sm text-gray-400 mb-4">Provide your OpenWeatherMap API key to enable the Weather app. You can get a free key from <a href="https://home.openweathermap.org/api_keys" target="_blank" class="text-blue-400 hover:underline">OpenWeatherMap</a>.</p>
          
          <div class="flex gap-2 mb-2">
            <div class="relative flex-grow">
              <input [type]="isOpenWeatherKeyVisible() ? 'text' : 'password'"
                     placeholder="Enter your OpenWeatherMap API key..."
                     [value]="openWeatherApiKey()"
                     (input)="openWeatherApiKey.set($any($event.target).value)"
                     class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 accent-ring-focus pr-10">
              <button (click)="isOpenWeatherKeyVisible.set(!isOpenWeatherKeyVisible())" class="absolute inset-y-0 right-0 px-3 text-gray-400 hover:text-white">
                <i class="fas" [class.fa-eye]="!isOpenWeatherKeyVisible()" [class.fa-eye-slash]="isOpenWeatherKeyVisible()"></i>
              </button>
            </div>
            <button (click)="saveOpenWeatherApiKey()" class="accent-bg text-white font-semibold px-4 py-2 rounded-md hover:opacity-90 transition-opacity">
                <i class="fas fa-save mr-2"></i>Save
            </button>
          </div>
          <div class="text-xs text-gray-500">
            <span>Status: </span>
            @if (apiKeyService.openWeatherApiKey()) {
              <span class="text-green-400">Key is set ({{ maskedOpenWeatherApiKey() }})</span>
            } @else {
              <span class="text-yellow-400">Not configured</span>
            }
          </div>
        </div>
      }
      @case ('system') {
        <h3 class="text-2xl font-bold mb-6">System Information</h3>
        <div class="bg-gray-800/50 p-4 rounded-lg">
          <p><strong>OS:</strong> Banana OS</p>
          <p><strong>Version:</strong> 1.0 (Angular)</p>
          <p><strong>Environment:</strong> Web Applet</p>
        </div>
      }
      @case ('data') {
        <h3 class="text-2xl font-bold mb-6">Data Management</h3>
        
        <div class="mb-8 p-4 bg-gray-800/50 rounded-lg">
            <h4 class="text-lg font-semibold mb-3">Export Encrypted Settings</h4>
            <p class="text-sm text-gray-400 mb-4">Save your personalization settings to a file. Set a password to encrypt it.</p>
            <div class="flex gap-4">
                <input type="password" 
                       placeholder="Enter password..."
                       [value]="exportPassword()"
                       (input)="exportPassword.set($any($event.target).value)"
                       class="flex-1 bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 accent-ring-focus">
                <button (click)="exportSettings()" class="accent-bg text-white font-semibold px-4 py-2 rounded-md hover:opacity-90 transition-opacity">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
        </div>

        <div class="p-4 bg-gray-800/50 rounded-lg">
            <h4 class="text-lg font-semibold mb-3">Import Encrypted Settings</h4>
            <p class="text-sm text-gray-400 mb-4">Load your personalization settings from a file. You will need the password used for encryption.</p>
            <div class="space-y-4">
                <div>
                    <label for="import-file-input" class="block text-sm font-medium text-gray-300 mb-1">Settings File</label>
                    <input id="import-file-input"
                           type="file" 
                           (change)="handleFileSelect($event)"
                           accept=".json"
                           class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:accent-bg file:text-white hover:file:opacity-90">
                </div>
                 <div>
                    <label for="import-password" class="block text-sm font-medium text-gray-300 mb-1">Decryption Password</label>
                    <input id="import-password"
                           type="password"
                           placeholder="Enter password..."
                           [value]="importPassword()"
                           (input)="importPassword.set($any($event.target).value)"
                           class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 accent-ring-focus">
                </div>
                <button (click)="importSettings()" class="accent-bg text-white font-semibold px-4 py-2 rounded-md hover:opacity-90 transition-opacity w-full">
                    <i class="fas fa-upload mr-2"></i>Import & Apply
                </button>
            </div>
        </div>
      }
    }
  </div>
</div>
